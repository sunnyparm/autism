# PythonAnywhere 가상환경에서 크롤링이 안 되는 이유

## 🔍 주요 원인

### 1. **PythonAnywhere 무료 계정의 네트워크 제한**
   
**가장 큰 이유입니다!**

PythonAnywhere 무료 계정은 **화이트리스트에 있는 사이트만** 접근 가능합니다.

```
❌ autismkorea.kr → 화이트리스트에 없음 → 접근 차단!
```

**확인 방법:**
- 화이트리스트 확인: https://www.pythonanywhere.com/whitelist/
- `autismkorea.kr`이 목록에 없으면 무료 계정으로는 접근 불가능

**해결책:**
- ✅ **유료 계정 사용** ($5/월) - 모든 외부 사이트 접근 가능
- ✅ **로컬 컴퓨터에서 실행** (추천)
- ✅ **다른 호스팅 서비스 사용** (AWS, Heroku, Google Cloud 등)

---

### 2. **환경 변수가 가상환경에 적용되지 않음**

현재 코드의 환경 변수 설정이 PythonAnywhere 가상환경에서 무시될 수 있습니다.

```python
# 이 부분이 가상환경에서 제대로 작동하지 않을 수 있음
os.environ['OPENSSL_CONF'] = '/dev/null'
```

**해결책:**

#### 방법 1: 가상환경 활성화 스크립트 수정

```bash
# PythonAnywhere 배시 콘솔에서
cd ~/.virtualenvs/YOUR_VENV_NAME/bin/
nano activate
```

`activate` 파일 끝에 추가:
```bash
export OPENSSL_CONF=/dev/null
export PYTHONHTTPSVERIFY=0
export CURL_CA_BUNDLE=''
export REQUESTS_CA_BUNDLE=''
```

#### 방법 2: 실행 스크립트 작성

`run_crawler.sh` 파일 생성:
```bash
#!/bin/bash
export OPENSSL_CONF=/dev/null
export PYTHONHTTPSVERIFY=0
export CURL_CA_BUNDLE=''
export REQUESTS_CA_BUNDLE=''

cd /home/YOUR_USERNAME/autism
source ~/.virtualenvs/YOUR_VENV_NAME/bin/activate
python3 한국자폐인사랑협회_크롤링.py
```

실행 권한 부여:
```bash
chmod +x run_crawler.sh
```

스케줄러에 등록:
```bash
/home/YOUR_USERNAME/autism/run_crawler.sh
```

---

### 3. **Python/OpenSSL 버전 불일치**

PythonAnywhere의 Python 버전과 로컬 환경이 다를 수 있습니다.

**확인:**
```bash
# PythonAnywhere 배시 콘솔에서
python3 --version
python3 -c "import ssl; print(ssl.OPENSSL_VERSION)"
```

**로컬과 비교:**
```bash
# 로컬에서
python --version
python -c "import ssl; print(ssl.OPENSSL_VERSION)"
```

**해결책:**
```bash
# PythonAnywhere에서 최신 Python 사용
python3.10 한국자폐인사랑협회_크롤링.py
# 또는
python3.11 한국자폐인사랑협회_크롤링.py
```

---

### 4. **pip 패키지 버전 차이**

가상환경의 패키지 버전이 로컬과 다를 수 있습니다.

**확인:**
```bash
# 가상환경에서
pip list | grep -E "requests|urllib3|beautifulsoup4"
```

**해결책:**
```bash
# 최신 버전으로 업데이트
pip install --upgrade requests urllib3 beautifulsoup4
pip install --upgrade certifi
```

---

## 🧪 디버깅 방법

### 테스트 스크립트 작성

`test_connection.py` 파일 생성:

```python
import os
os.environ['OPENSSL_CONF'] = '/dev/null'
os.environ['PYTHONHTTPSVERIFY'] = '0'

import requests
import ssl

print("=" * 50)
print("환경 정보")
print("=" * 50)
print(f"Python SSL 버전: {ssl.OPENSSL_VERSION}")
print(f"OPENSSL_CONF: {os.environ.get('OPENSSL_CONF', 'NOT SET')}")
print()

print("=" * 50)
print("연결 테스트 1: Google (화이트리스트)")
print("=" * 50)
try:
    res = requests.get('https://www.google.com', timeout=10, verify=False)
    print(f"✅ 성공: {res.status_code}")
except Exception as e:
    print(f"❌ 실패: {e}")

print()
print("=" * 50)
print("연결 테스트 2: autismkorea.kr (목표 사이트)")
print("=" * 50)
try:
    res = requests.get('https://www.autismkorea.kr/', timeout=10, verify=False)
    print(f"✅ 성공: {res.status_code}")
except Exception as e:
    print(f"❌ 실패: {e}")
    print("\n👉 이 오류가 발생하면 무료 계정 제한입니다!")
```

**실행:**
```bash
python3 test_connection.py
```

---

## 📊 예상 결과 및 해결책

### Case 1: Google ✅, autismkorea ❌
```
✅ Google 성공
❌ autismkorea 실패
```
**원인:** PythonAnywhere 무료 계정 네트워크 제한  
**해결:** 유료 계정 또는 로컬 실행

### Case 2: 둘 다 ❌
```
❌ Google 실패
❌ autismkorea 실패
```
**원인:** 가상환경 설정 문제  
**해결:** 환경 변수 재설정, Python 버전 변경

### Case 3: 둘 다 ✅
```
✅ Google 성공
✅ autismkorea 성공
```
**상태:** 정상 작동!  
**다음:** 크롤링 스크립트 실행

---

## 🎯 최종 권장 해결 방법

### 방법 1: 로컬 컴퓨터에서 실행 (가장 권장)

**Windows 작업 스케줄러:**
```
프로그램: C:\Python\python.exe
인수: C:\Users\KR\Desktop\git_repo\autism\한국자폐인사랑협회_크롤링.py
시작 위치: C:\Users\KR\Desktop\git_repo\autism
트리거: 매일 오전 9시
```

**장점:**
- ✅ 무료
- ✅ 제한 없음
- ✅ 현재 로컬에서 잘 작동함

**단점:**
- ❌ 컴퓨터를 켜놓아야 함

---

### 방법 2: PythonAnywhere 유료 계정

**비용:** $5/월

**장점:**
- ✅ 24시간 자동 실행
- ✅ 모든 사이트 접근 가능
- ✅ 안정적

---

### 방법 3: GitHub Actions (무료 대안)

`.github/workflows/crawler.yml`:
```yaml
name: Daily Crawler

on:
  schedule:
    - cron: '0 0 * * *'  # 매일 자정
  workflow_dispatch:  # 수동 실행 가능

jobs:
  crawl:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - run: |
          pip install -r requirements.txt
          python 한국자폐인사랑협회_크롤링.py
```

**장점:**
- ✅ 완전 무료
- ✅ 자동 실행
- ✅ 제한 없음

---

## 💡 즉시 확인 방법

PythonAnywhere 배시 콘솔에서 다음 명령어 실행:

```bash
# 1. 화이트리스트 확인
curl -I https://www.autismkorea.kr/

# 403 또는 연결 오류 → 무료 계정 제한!
# 200 → 접근 가능
```

**403 Forbidden 또는 연결 실패가 나오면:**
→ PythonAnywhere 무료 계정의 네트워크 제한이 원인입니다!
→ 유료 계정으로 업그레이드하거나 로컬에서 실행하세요.

